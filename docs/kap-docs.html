<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-kap-docs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Kasih AP Gold Documentation | CSC Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://creative-system-consultant.github.io/csc-docs/img/csc-logo.png"><meta data-rh="true" name="twitter:image" content="https://creative-system-consultant.github.io/csc-docs/img/csc-logo.png"><meta data-rh="true" property="og:url" content="https://creative-system-consultant.github.io/csc-docs/docs/kap-docs"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Kasih AP Gold Documentation | CSC Docs"><meta data-rh="true" name="description" content="Table of Contents"><meta data-rh="true" property="og:description" content="Table of Contents"><link data-rh="true" rel="icon" href="/csc-docs/img/csc-logo.png"><link data-rh="true" rel="canonical" href="https://creative-system-consultant.github.io/csc-docs/docs/kap-docs"><link data-rh="true" rel="alternate" href="https://creative-system-consultant.github.io/csc-docs/docs/kap-docs" hreflang="en"><link data-rh="true" rel="alternate" href="https://creative-system-consultant.github.io/csc-docs/docs/kap-docs" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Kasih AP Gold Documentation","item":"https://creative-system-consultant.github.io/csc-docs/docs/kap-docs"}]}</script><link rel="alternate" type="application/rss+xml" href="/csc-docs/blog/rss.xml" title="CSC Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/csc-docs/blog/atom.xml" title="CSC Docs Atom Feed"><link rel="stylesheet" href="/csc-docs/assets/css/styles.a1b23a25.css">
<script src="/csc-docs/assets/js/runtime~main.01df2112.js" defer="defer"></script>
<script src="/csc-docs/assets/js/main.2e749da9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/csc-docs/img/csc-logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/csc-docs/"><div class="navbar__logo"><img src="/csc-docs/img/csc-logo.png" alt="CSC Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/csc-docs/img/csc-logo.png" alt="CSC Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">CSC Documentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/csc-docs/docs/sfms-docs">Documentation</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/creative-system-consultant/csc-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/csc-docs/docs/sfms-docs">SSM SFMS Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/csc-docs/docs/pmgi-docs">TEKUN PMGI Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/csc-docs/docs/kap-docs">Kasih AP Gold Documentation</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/csc-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Kasih AP Gold Documentation</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>KAP (Kasih AP Gold) Trading Platform Documentation</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents">Table of Contents<a href="#table-of-contents" class="hash-link" aria-label="Direct link to Table of Contents" title="Direct link to Table of Contents">â€‹</a></h2>
<ol>
<li><a href="#project-overview">Project Overview</a></li>
<li><a href="#system-architecture">System Architecture</a></li>
<li><a href="#development-environment-setup">Development Environment Setup</a></li>
<li><a href="#authentication--authorization">Authentication &amp; Authorization</a></li>
<li><a href="#core-business-logic">Core Business Logic</a></li>
<li><a href="#payment-integration-systems">Payment Integration Systems</a></li>
<li><a href="#frontend-architecture-livewire">Frontend Architecture (Livewire)</a></li>
<li><a href="#database-schema--relationships">Database Schema &amp; Relationships</a></li>
<li><a href="#api-endpoints--routes">API Endpoints &amp; Routes</a></li>
<li><a href="#critical-security-issues">Critical Security Issues</a></li>
<li><a href="#deployment-guide">Deployment Guide</a></li>
<li><a href="#maintenance--support">Maintenance &amp; Support</a></li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-overview">Project Overview<a href="#project-overview" class="hash-link" aria-label="Direct link to Project Overview" title="Direct link to Project Overview">â€‹</a></h2>
<p><strong>KAP (Kasih AP Gold)</strong> is a comprehensive Malaysian gold trading platform built with Laravel 8, offering:</p>
<ul>
<li>Digital and physical gold trading</li>
<li>Multi-level marketing (MLM) agent structure</li>
<li>Islamic pawn services (Ar-Rahnu)</li>
<li>Commission management system</li>
<li>Real-time auction system (Lelongan)</li>
<li>Multiple payment gateway integrations</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-stakeholders">Key Stakeholders<a href="#key-stakeholders" class="hash-link" aria-label="Direct link to Key Stakeholders" title="Direct link to Key Stakeholders">â€‹</a></h3>
<ul>
<li><strong>Kasih Gold</strong>: Primary client (client_id = 1)</li>
<li><strong>Kasih AP Gold</strong>: Secondary client (client_id = 2)</li>
<li><strong>Agents</strong>: Multi-tier marketing structure</li>
<li><strong>Customers</strong>: End users trading gold</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="technology-stack">Technology Stack<a href="#technology-stack" class="hash-link" aria-label="Direct link to Technology Stack" title="Direct link to Technology Stack">â€‹</a></h3>
<ul>
<li><strong>Backend</strong>: Laravel 8, PHP 7.3+</li>
<li><strong>Frontend</strong>: Livewire 2, Alpine.js, Tailwind CSS</li>
<li><strong>Database</strong>: MySQL (primary), SQL Server (Arrahnu system)</li>
<li><strong>Real-time</strong>: Laravel WebSockets, Pusher</li>
<li><strong>Payment</strong>: ToyyibPay, Snap N Pay</li>
<li><strong>Queue</strong>: Redis/Database</li>
<li><strong>Email</strong>: SMTP with custom templates</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-architecture">System Architecture<a href="#system-architecture" class="hash-link" aria-label="Direct link to System Architecture" title="Direct link to System Architecture">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-database-architecture">Multi-Database Architecture<a href="#multi-database-architecture" class="hash-link" aria-label="Direct link to Multi-Database Architecture" title="Direct link to Multi-Database Architecture">â€‹</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   Primary DB    â”‚    â”‚   ArrahnuDB     â”‚    â”‚   External APIs â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   (MySQL)       â”‚    â”‚  (SQL Server)   â”‚    â”‚   (Payment)     â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚ â€¢ Users         â”‚    â”‚ â€¢ Pawn Records  â”‚    â”‚ â€¢ ToyyibPay     â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚ â€¢ Gold Trading  â”‚    â”‚ â€¢ Auctions      â”‚    â”‚ â€¢ SnapNPay      â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚ â€¢ Commissions   â”‚    â”‚ â€¢ Branches      â”‚    â”‚ â€¢ eSMS          â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚ â€¢ Inventory     â”‚    â”‚ â€¢ Daily Prices  â”‚    â”‚ â€¢ Market Prices â”‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-layers">Application Layers<a href="#application-layers" class="hash-link" aria-label="Direct link to Application Layers" title="Direct link to Application Layers">â€‹</a></h3>
<ol>
<li><strong>Presentation Layer</strong>: Livewire components + Blade templates</li>
<li><strong>Business Logic Layer</strong>: Controllers, Services, and Models</li>
<li><strong>Data Access Layer</strong>: Eloquent ORM, Raw SQL (for complex queries)</li>
<li><strong>Integration Layer</strong>: Payment gateways, SMS services, external APIs</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-environment-setup">Development Environment Setup<a href="#development-environment-setup" class="hash-link" aria-label="Direct link to Development Environment Setup" title="Direct link to Development Environment Setup">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">â€‹</a></h3>
<ul>
<li>PHP 7.3+ (with extensions: mbstring, openssl, PDO, Tokenizer, XML, JSON)</li>
<li>Node.js 12+ and NPM</li>
<li>MySQL 5.7+ or MariaDB 10.3+</li>
<li>Redis (optional, for queues)</li>
<li>Composer 2.0+</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="installation-steps">Installation Steps<a href="#installation-steps" class="hash-link" aria-label="Direct link to Installation Steps" title="Direct link to Installation Steps">â€‹</a></h3>
<ol>
<li><strong>Clone and Install Dependencies</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone &lt;repository-url&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd kap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">composer install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install</span><br></span></code></pre></div></div>
<ol start="2">
<li><strong>Environment Configuration</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cp .env.example .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan key:generate</span><br></span></code></pre></div></div>
<ol start="3">
<li><strong>Database Setup</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -u root -p -e &quot;CREATE DATABASE kap_gold;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run migrations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan migrate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Seed database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan db:seed</span><br></span></code></pre></div></div>
<ol start="4">
<li><strong>Build Assets</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm run dev          # Development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run watch        # Watch for changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run prod         # Production</span><br></span></code></pre></div></div>
<ol start="5">
<li><strong>Development Server</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">php artisan serve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan queue:work    # For background jobs</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="environment-variables-env">Environment Variables (.env)<a href="#environment-variables-env" class="hash-link" aria-label="Direct link to Environment Variables (.env)" title="Direct link to Environment Variables (.env)">â€‹</a></h3>
<div class="language-env codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-env codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">APP_NAME=&quot;KAP Gold Trading&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_ENV=local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_DEBUG=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_URL=http://localhost:8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_CONNECTION=mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_HOST=127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_DATABASE=kap_gold</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_USERNAME=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_PASSWORD=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Payment Gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TOYYIBPAY_API_KEY=your_api_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TOYYIBPAY_CATEGORY_CODE=your_category_code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SMS Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESMS_API_KEY=your_esms_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESMS_USERNAME=your_username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESMS_PASSWORD=your_password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># WebSocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PUSHER_APP_ID=your_app_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PUSHER_APP_KEY=your_app_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PUSHER_APP_SECRET=your_app_secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PUSHER_APP_CLUSTER=mt1</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="authentication--authorization">Authentication &amp; Authorization<a href="#authentication--authorization" class="hash-link" aria-label="Direct link to Authentication &amp; Authorization" title="Direct link to Authentication &amp; Authorization">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-role-system">User Role System<a href="#user-role-system" class="hash-link" aria-label="Direct link to User Role System" title="Direct link to User Role System">â€‹</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// User roles in database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 =&gt; &#x27;Administrator&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 =&gt; &#x27;Master Dealer&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 =&gt; &#x27;Premium Agent (Agent)&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 =&gt; &#x27;Agent (User registration default)&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 =&gt; &#x27;Retail - VVIP&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 =&gt; &#x27;Retail - Public&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authentication-flow">Authentication Flow<a href="#authentication-flow" class="hash-link" aria-label="Direct link to Authentication Flow" title="Direct link to Authentication Flow">â€‹</a></h3>
<ol>
<li><strong>Registration</strong>: Creates user with role=4, requires referral code</li>
<li><strong>OTP Verification</strong>: SMS-based verification via eSMS API</li>
<li><strong>Profile Completion</strong>: Required before system access</li>
<li><strong>Screening</strong>: Admin approval process for full access</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-models">Key Models<a href="#key-models" class="hash-link" aria-label="Direct link to Key Models" title="Direct link to Key Models">â€‹</a></h3>
<ul>
<li><strong>User</strong>: Core authentication entity</li>
<li><strong>Roles</strong>: Role definitions</li>
<li><strong>Profile_personal</strong>: Personal information</li>
<li><strong>Profile_bank_info</strong>: Banking details</li>
<li><strong>ReferralCode</strong>: Referral tracking</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="middleware-stack">Middleware Stack<a href="#middleware-stack" class="hash-link" aria-label="Direct link to Middleware Stack" title="Direct link to Middleware Stack">â€‹</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Route protection layers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;auth&#x27; =&gt; Authenticate::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;auth.admin&#x27; =&gt; AuthAdmin::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;verified.otp&#x27; =&gt; VerifiedOTP::class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;passScreen&#x27; =&gt; PassScreening::class,</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-implementation">Security Implementation<a href="#security-implementation" class="hash-link" aria-label="Direct link to Security Implementation" title="Direct link to Security Implementation">â€‹</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// User model role checks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function isAdminKAP(): bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $this-&gt;client == 2 &amp;&amp; $this-&gt;role == 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function isAgentKAP(): bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $this-&gt;client == 2 &amp;&amp; $this-&gt;role == 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function isUserKAP(): bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $this-&gt;client == 2 &amp;&amp; $this-&gt;role == 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-business-logic">Core Business Logic<a href="#core-business-logic" class="hash-link" aria-label="Direct link to Core Business Logic" title="Direct link to Core Business Logic">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="main-business-entities">Main Business Entities<a href="#main-business-entities" class="hash-link" aria-label="Direct link to Main Business Entities" title="Direct link to Main Business Entities">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="gold-trading-system">Gold Trading System<a href="#gold-trading-system" class="hash-link" aria-label="Direct link to Gold Trading System" title="Direct link to Gold Trading System">â€‹</a></h4>
<ul>
<li><strong>Goldbar</strong>: Physical gold inventory with weight tracking</li>
<li><strong>GoldbarOwnership</strong>: User ownership of gold portions</li>
<li><strong>GoldbarOwnershipPending</strong>: Pending ownership transfers</li>
<li><strong>MarketPrice</strong>: Current market pricing</li>
<li><strong>SpotGoldPricing</strong>: Weight-based pricing tiers</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="commission-system">Commission System<a href="#commission-system" class="hash-link" aria-label="Direct link to Commission System" title="Direct link to Commission System">â€‹</a></h4>
<ul>
<li><strong>CommissionRate</strong>: Base commission rates</li>
<li><strong>CommissionDetail</strong>: Individual commission records</li>
<li><strong>CommissionRateKap</strong>: KAP-specific rates</li>
<li><strong>CommissionDetailKap</strong>: KAP commission tracking</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="inventory-management">Inventory Management<a href="#inventory-management" class="hash-link" aria-label="Direct link to Inventory Management" title="Direct link to Inventory Management">â€‹</a></h4>
<ul>
<li><strong>InvItem</strong>: Product catalog</li>
<li><strong>InvMaster</strong>: Individual item instances</li>
<li><strong>InvMovement</strong>: Stock movement tracking</li>
<li><strong>InvCart</strong>: Shopping cart functionality</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="business-processes">Business Processes<a href="#business-processes" class="hash-link" aria-label="Direct link to Business Processes" title="Direct link to Business Processes">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="gold-purchase-flow">Gold Purchase Flow<a href="#gold-purchase-flow" class="hash-link" aria-label="Direct link to Gold Purchase Flow" title="Direct link to Gold Purchase Flow">â€‹</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 1. Add to cart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InvCart::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;user_id&#x27; =&gt; $user-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;item_id&#x27; =&gt; $item-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;quantity&#x27; =&gt; $quantity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;price&#x27; =&gt; $calculated_price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. Payment processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$payment = ToyyibPay::createBill([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;amount&#x27; =&gt; $total_amount,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;reference&#x27; =&gt; $unique_reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 3. Create pending ownership</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GoldbarOwnershipPending::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;user_id&#x27; =&gt; $user-&gt;id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;weight&#x27; =&gt; $weight,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;bought_price&#x27; =&gt; $price,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;status&#x27; =&gt; 2 // Pending</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 4. Reserve gold</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$goldbar-&gt;update([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;weight_on_hold&#x27; =&gt; $goldbar-&gt;weight_on_hold + $weight</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="commission-calculation">Commission Calculation<a href="#commission-calculation" class="hash-link" aria-label="Direct link to Commission Calculation" title="Direct link to Commission Calculation">â€‹</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Agent commission reduces purchase price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$commission = CommissionRate::where(&#x27;item_id&#x27;, $item-&gt;id)-&gt;first();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$final_price = $market_price - $commission-&gt;agent_rate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Spot gold pricing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$spot_percentage = SpotGoldPricing::getPercentage($weight);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$spot_price = ($market_price + ($market_price * $spot_percentage)) * $weight;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ar-rahnu-islamic-pawn-system">Ar-Rahnu (Islamic Pawn) System<a href="#ar-rahnu-islamic-pawn-system" class="hash-link" aria-label="Direct link to Ar-Rahnu (Islamic Pawn) System" title="Direct link to Ar-Rahnu (Islamic Pawn) System">â€‹</a></h3>
<ul>
<li><strong>Separate SQL Server Database</strong> (arrahnudb)</li>
<li><strong>Quarterly payment structure</strong></li>
<li><strong>Auction system for defaults</strong></li>
<li><strong>Branch-based operations</strong></li>
<li><strong>Sharia-compliant processes</strong></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="payment-integration-systems">Payment Integration Systems<a href="#payment-integration-systems" class="hash-link" aria-label="Direct link to Payment Integration Systems" title="Direct link to Payment Integration Systems">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="toyyibpay-integration">ToyyibPay Integration<a href="#toyyibpay-integration" class="hash-link" aria-label="Direct link to ToyyibPay Integration" title="Direct link to ToyyibPay Integration">â€‹</a></h3>
<p><strong>Primary Malaysian payment gateway</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">â€‹</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// config/toyyibpay.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;api_key&#x27; =&gt; env(&#x27;TOYYIBPAY_API_KEY&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;category_code&#x27; =&gt; env(&#x27;TOYYIBPAY_CATEGORY_CODE&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;endpoint&#x27; =&gt; &#x27;https://dev.toyyibpay.com/index.php/api/createBill&#x27;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="bill-creation">Bill Creation<a href="#bill-creation" class="hash-link" aria-label="Direct link to Bill Creation" title="Direct link to Bill Creation">â€‹</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ToyyibpayController@createBill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$bill = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;userSecretKey&#x27; =&gt; config(&#x27;toyyibpay.api_key&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;categoryCode&#x27; =&gt; config(&#x27;toyyibpay.category_code&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;billName&#x27; =&gt; &#x27;Gold Purchase&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;billDescription&#x27; =&gt; &#x27;Digital Gold Purchase&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;billAmount&#x27; =&gt; $amount,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;billReturnUrl&#x27; =&gt; route(&#x27;toyyibpay-status&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;billCallbackUrl&#x27; =&gt; route(&#x27;toyyibpay-callback&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;billPayorEmail&#x27; =&gt; $user-&gt;email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">];</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="callback-processing">Callback Processing<a href="#callback-processing" class="hash-link" aria-label="Direct link to Callback Processing" title="Direct link to Callback Processing">â€‹</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Callback endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::post(&#x27;toyyibpay-callback&#x27;, [ToyyibpayController::class, &#x27;callback&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::post(&#x27;toyyibpay-callback-mint&#x27;, [ToyyibpayController::class, &#x27;callbackMint&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::post(&#x27;toyyibpay-callbackConv&#x27;, [ToyyibpayController::class, &#x27;callbackConv&#x27;]);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="snap-n-pay-integration">Snap N Pay Integration<a href="#snap-n-pay-integration" class="hash-link" aria-label="Direct link to Snap N Pay Integration" title="Direct link to Snap N Pay Integration">â€‹</a></h3>
<p><strong>Alternative payment provider</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-1">Configuration<a href="#configuration-1" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">â€‹</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Production endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;endpoint&#x27; =&gt; &#x27;https://prod.snapnpay.co/payments/api&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-critical-security-issue">ğŸš¨ <strong>CRITICAL SECURITY ISSUE</strong><a href="#-critical-security-issue" class="hash-link" aria-label="Direct link to -critical-security-issue" title="Direct link to -critical-security-issue">â€‹</a></h3>
<p><strong>Payment callback endpoints lack cryptographic signature verification, making them vulnerable to spoofing attacks.</strong></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="frontend-architecture-livewire">Frontend Architecture (Livewire)<a href="#frontend-architecture-livewire" class="hash-link" aria-label="Direct link to Frontend Architecture (Livewire)" title="Direct link to Frontend Architecture (Livewire)">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="component-structure">Component Structure<a href="#component-structure" class="hash-link" aria-label="Direct link to Component Structure" title="Direct link to Component Structure">â€‹</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">app/Http/Livewire/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ Auth/                    # Authentication components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ Login.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ Register.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ VerifyOtp.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ Page/                    # Main application pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ Admin/              # Admin interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ DigitalGold/        # Gold trading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ PhysicalGold/       # Physical gold conversion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ Cart/               # Shopping cart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ Lelongan/          # Auction system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ Reporting/         # Business intelligence</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-livewire-components">Key Livewire Components<a href="#key-livewire-components" class="hash-link" aria-label="Direct link to Key Livewire Components" title="Direct link to Key Livewire Components">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="digital-gold-trading">Digital Gold Trading<a href="#digital-gold-trading" class="hash-link" aria-label="Direct link to Digital Gold Trading" title="Direct link to Digital Gold Trading">â€‹</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// DigitalGold.php - Main trading interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DigitalGold extends Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public $userGold, $portfolio, $marketPrice;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function mount()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;userGold = GoldbarOwnership::where(&#x27;user_id&#x27;, auth()-&gt;id())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         -&gt;where(&#x27;active_ownership&#x27;, 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         -&gt;sum(&#x27;weight&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function render()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return view(&#x27;livewire.page.digital-gold.digital-gold&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="real-time-auction-system">Real-time Auction System<a href="#real-time-auction-system" class="hash-link" aria-label="Direct link to Real-time Auction System" title="Direct link to Real-time Auction System">â€‹</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Lelongan.php - Auction bidding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Lelongan extends Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public $currentBid, $bidAmount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function placeBid()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Real-time bid processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        event(new BidPlaced($this-&gt;bidAmount, auth()-&gt;user()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="frontend-technologies">Frontend Technologies<a href="#frontend-technologies" class="hash-link" aria-label="Direct link to Frontend Technologies" title="Direct link to Frontend Technologies">â€‹</a></h3>
<ul>
<li><strong>Tailwind CSS</strong>: Utility-first CSS framework</li>
<li><strong>Alpine.js</strong>: Lightweight JavaScript framework</li>
<li><strong>ApexCharts</strong>: Data visualization</li>
<li><strong>WebSockets</strong>: Real-time features (auctions, notifications)</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="database-schema--relationships">Database Schema &amp; Relationships<a href="#database-schema--relationships" class="hash-link" aria-label="Direct link to Database Schema &amp; Relationships" title="Direct link to Database Schema &amp; Relationships">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="core-tables">Core Tables<a href="#core-tables" class="hash-link" aria-label="Direct link to Core Tables" title="Direct link to Core Tables">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="user-management">User Management<a href="#user-management" class="hash-link" aria-label="Direct link to User Management" title="Direct link to User Management">â€‹</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> users </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    role </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active </span><span class="token keyword" style="color:#00009f">TINYINT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    otp_verified_at </span><span class="token keyword" style="color:#00009f">TIMESTAMP</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    created_at </span><span class="token keyword" style="color:#00009f">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="gold-trading">Gold Trading<a href="#gold-trading" class="hash-link" aria-label="Direct link to Gold Trading" title="Direct link to Gold Trading">â€‹</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> goldbar </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    guid </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bought_price </span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total_weight </span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weight_occupied </span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weight_on_hold </span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weight_vacant </span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    created_at </span><span class="token keyword" style="color:#00009f">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> goldbar_ownership </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    goldbar_id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weight </span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bought_price </span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active_ownership </span><span class="token keyword" style="color:#00009f">TINYINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    created_at </span><span class="token keyword" style="color:#00009f">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-critical-database-issue">ğŸš¨ <strong>CRITICAL DATABASE ISSUE</strong><a href="#-critical-database-issue" class="hash-link" aria-label="Direct link to -critical-database-issue" title="Direct link to -critical-database-issue">â€‹</a></h3>
<p><strong>Missing foreign key constraints across all tables, risking data integrity</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-relationships">Key Relationships<a href="#key-relationships" class="hash-link" aria-label="Direct link to Key Relationships" title="Direct link to Key Relationships">â€‹</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// User Model relationships</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function goldOwnership()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $this-&gt;hasMany(GoldbarOwnership::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function upline()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $this-&gt;hasOne(UserUpline::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function downlines()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $this-&gt;hasMany(UserDownline::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api-endpoints--routes">API Endpoints &amp; Routes<a href="#api-endpoints--routes" class="hash-link" aria-label="Direct link to API Endpoints &amp; Routes" title="Direct link to API Endpoints &amp; Routes">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="web-routes-structure">Web Routes Structure<a href="#web-routes-structure" class="hash-link" aria-label="Direct link to Web Routes Structure" title="Direct link to Web Routes Structure">â€‹</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Guest routes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::middleware(&#x27;guest&#x27;)-&gt;group(function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Route::get(&#x27;login&#x27;, Login::class)-&gt;name(&#x27;login&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Route::get(&#x27;register/{code}&#x27;, Register::class)-&gt;name(&#x27;register&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Route::post(&#x27;toyyibpay-callback&#x27;, [ToyyibpayController::class, &#x27;callback&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Authenticated routes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::middleware(&#x27;auth&#x27;)-&gt;group(function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Route::middleware([&#x27;passScreen&#x27;, &#x27;verified.otp&#x27;])-&gt;group(function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Route::get(&#x27;home&#x27;, [DashboardController::class, &#x27;index&#x27;])-&gt;name(&#x27;home&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Route::get(&#x27;digital-gold&#x27;, [DigitalGoldController::class, &#x27;index&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Route::get(&#x27;physical-gold&#x27;, [PhysicalGoldController::class, &#x27;index&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Admin routes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Route::middleware(&#x27;auth.admin&#x27;)-&gt;group(function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Route::get(&#x27;admin/user-management&#x27;, UserManagement::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Route::get(&#x27;reporting/gold-report&#x27;, GoldReport::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-endpoints">API Endpoints<a href="#api-endpoints" class="hash-link" aria-label="Direct link to API Endpoints" title="Direct link to API Endpoints">â€‹</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// api.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::post(&#x27;/login&#x27;, [AuthController::class, &#x27;login&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::post(&#x27;/register&#x27;, [AuthController::class, &#x27;register&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::get(&#x27;/market-price&#x27;, [MarketPriceController::class, &#x27;index&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::middleware(&#x27;auth:sanctum&#x27;)-&gt;group(function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Route::post(&#x27;/logout&#x27;, [AuthController::class, &#x27;logout&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="critical-security-issues">Critical Security Issues<a href="#critical-security-issues" class="hash-link" aria-label="Direct link to Critical Security Issues" title="Direct link to Critical Security Issues">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-immediate-action-required">ğŸ”´ <strong>IMMEDIATE ACTION REQUIRED</strong><a href="#-immediate-action-required" class="hash-link" aria-label="Direct link to -immediate-action-required" title="Direct link to -immediate-action-required">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-sql-injection-vulnerabilities">1. SQL Injection Vulnerabilities<a href="#1-sql-injection-vulnerabilities" class="hash-link" aria-label="Direct link to 1. SQL Injection Vulnerabilities" title="Direct link to 1. SQL Injection Vulnerabilities">â€‹</a></h4>
<p><strong>File</strong>: <code>app/Http/Controllers/ReportingController.php</code>
<strong>Lines</strong>: 53-59, 74-82, 84-92</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// VULNERABLE CODE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$data = DB::select(&quot;select user_id, CAST(YEAR(created_at) AS VARCHAR(4)) + &#x27;-&#x27; + CAST(MONTH(created_at) AS VARCHAR(2)) AS date, SUM(commission) AS commission, status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FROM commission_detail_kaps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    where user_id = &#x27;&quot;.$agent.&quot;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        and CAST (created_at as date) &gt;= &#x27;&quot;. $date-&gt;startOfMonth()-&gt;toDateString() . &quot;&#x27;&quot;);</span><br></span></code></pre></div></div>
<p><strong>Fix Required</strong>: Use parameterized queries</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// SECURE CODE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$data = DB::select(&quot;SELECT user_id, CAST(YEAR(created_at) AS VARCHAR(4)) + &#x27;-&#x27; + CAST(MONTH(created_at) AS VARCHAR(2)) AS date, SUM(commission) AS commission, status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FROM commission_detail_kaps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    WHERE user_id = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        AND CAST(created_at AS DATE) &gt;= ?&quot;, [$agent, $date-&gt;startOfMonth()-&gt;toDateString()]);</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-payment-callback-vulnerabilities">2. Payment Callback Vulnerabilities<a href="#2-payment-callback-vulnerabilities" class="hash-link" aria-label="Direct link to 2. Payment Callback Vulnerabilities" title="Direct link to 2. Payment Callback Vulnerabilities">â€‹</a></h4>
<p><strong>File</strong>: <code>app/Http/Controllers/ToyyibpayController.php</code>
<strong>Issue</strong>: No signature verification for payment callbacks</p>
<p><strong>Fix Required</strong>: Implement webhook signature validation</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public function callback(Request $request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Verify webhook signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $signature = $request-&gt;header(&#x27;X-Signature&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $payload = $request-&gt;getContent();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $expectedSignature = hash_hmac(&#x27;sha256&#x27;, $payload, config(&#x27;toyyibpay.webhook_secret&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!hash_equals($signature, $expectedSignature)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return response()-&gt;json([&#x27;error&#x27; =&gt; &#x27;Invalid signature&#x27;], 401);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Process payment...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-authorization-bypass">3. Authorization Bypass<a href="#3-authorization-bypass" class="hash-link" aria-label="Direct link to 3. Authorization Bypass" title="Direct link to 3. Authorization Bypass">â€‹</a></h4>
<p><strong>File</strong>: <code>app/Http/Controllers/ProfileController.php</code>
<strong>Lines</strong>: 24-33, 35-44</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// VULNERABLE CODE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function deleteIcFront($id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Profile_personal::where(&#x27;user_id&#x27;, $id)-&gt;update([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;ic_front&#x27; =&gt; NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Fix Required</strong>: Add authorization check</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// SECURE CODE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function deleteIcFront($id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $user = auth()-&gt;user();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($user-&gt;id != $id &amp;&amp; !$user-&gt;isAdminKAP()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        abort(403, &#x27;Unauthorized&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Profile_personal::where(&#x27;user_id&#x27;, $id)-&gt;update([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;ic_front&#x27; =&gt; NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-csrf-protection-bypass">4. CSRF Protection Bypass<a href="#4-csrf-protection-bypass" class="hash-link" aria-label="Direct link to 4. CSRF Protection Bypass" title="Direct link to 4. CSRF Protection Bypass">â€‹</a></h4>
<p><strong>File</strong>: <code>app/Http/Middleware/VerifyCsrfToken.php</code>
<strong>Issue</strong>: Critical payment endpoints excluded from CSRF protection</p>
<p><strong>Fix Required</strong>: Implement alternative protection for payment callbacks</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Use signed URLs or token validation for payment callbacks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected $except = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Remove payment endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">];</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-database-foreign-key-constraints-missing">5. Database Foreign Key Constraints Missing<a href="#5-database-foreign-key-constraints-missing" class="hash-link" aria-label="Direct link to 5. Database Foreign Key Constraints Missing" title="Direct link to 5. Database Foreign Key Constraints Missing">â€‹</a></h4>
<p><strong>All Migration Files</strong>
<strong>Issue</strong>: No foreign key constraints defined</p>
<p><strong>Fix Required</strong>: Add foreign key constraints</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// In migrations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Schema::table(&#x27;goldbar_ownership&#x27;, function (Blueprint $table) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $table-&gt;foreign(&#x27;user_id&#x27;)-&gt;references(&#x27;id&#x27;)-&gt;on(&#x27;users&#x27;)-&gt;onDelete(&#x27;cascade&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $table-&gt;foreign(&#x27;goldbar_id&#x27;)-&gt;references(&#x27;id&#x27;)-&gt;on(&#x27;goldbar&#x27;)-&gt;onDelete(&#x27;cascade&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-guide">Deployment Guide<a href="#deployment-guide" class="hash-link" aria-label="Direct link to Deployment Guide" title="Direct link to Deployment Guide">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="production-environment-setup">Production Environment Setup<a href="#production-environment-setup" class="hash-link" aria-label="Direct link to Production Environment Setup" title="Direct link to Production Environment Setup">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="server-requirements">Server Requirements<a href="#server-requirements" class="hash-link" aria-label="Direct link to Server Requirements" title="Direct link to Server Requirements">â€‹</a></h4>
<ul>
<li><strong>PHP 8.0+</strong> with required extensions</li>
<li><strong>MySQL 8.0+</strong> or MariaDB 10.5+</li>
<li><strong>Redis</strong> for caching and queues</li>
<li><strong>Nginx/Apache</strong> web server</li>
<li><strong>SSL certificate</strong> (required for payment gateways)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-steps">Deployment Steps<a href="#deployment-steps" class="hash-link" aria-label="Direct link to Deployment Steps" title="Direct link to Deployment Steps">â€‹</a></h4>
<ol>
<li><strong>Server Preparation</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install php8.0-fpm php8.0-mysql php8.0-redis nginx redis-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configure PHP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo nano /etc/php/8.0/fpm/php.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set memory_limit = 256M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set upload_max_filesize = 10M</span><br></span></code></pre></div></div>
<ol start="2">
<li><strong>Application Deployment</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Clone repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone &lt;repo-url&gt; /var/www/kap-gold</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /var/www/kap-gold</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">composer install --no-dev --optimize-autoloader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install &amp;&amp; npm run production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chown -R www-data:www-data /var/www/kap-gold</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chmod -R 755 /var/www/kap-gold/storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chmod -R 755 /var/www/kap-gold/bootstrap/cache</span><br></span></code></pre></div></div>
<ol start="3">
<li><strong>Environment Configuration</strong></li>
</ol>
<div class="language-env codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-env codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">APP_ENV=production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_DEBUG=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP_URL=https://your-domain.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_CONNECTION=mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_HOST=localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_DATABASE=kap_gold_prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_USERNAME=kap_user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_PASSWORD=secure_password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cache &amp; Queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CACHE_DRIVER=redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QUEUE_CONNECTION=redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SESSION_DRIVER=redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Mail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAIL_MAILER=smtp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAIL_HOST=your-smtp-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAIL_PORT=587</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAIL_USERNAME=your-email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAIL_PASSWORD=your-password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAIL_ENCRYPTION=tls</span><br></span></code></pre></div></div>
<ol start="4">
<li><strong>Database Migration</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Run migrations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan migrate --force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Seed production data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan db:seed --class=ProductionSeeder</span><br></span></code></pre></div></div>
<ol start="5">
<li><strong>Queue Workers</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Install supervisor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install supervisor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create worker configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo nano /etc/supervisor/conf.d/kap-worker.conf</span><br></span></code></pre></div></div>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[program:kap-worker]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_name=%(program_name)s_%(process_num)02d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">command=php /var/www/kap-gold/artisan queue:work redis --sleep=3 --tries=3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autostart=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autorestart=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user=www-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">numprocs=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redirect_stderr=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stdout_logfile=/var/www/kap-gold/storage/logs/worker.log</span><br></span></code></pre></div></div>
<ol start="6">
<li><strong>Web Server Configuration</strong></li>
</ol>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name your-domain.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 301 https://$server_name$request_uri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 443 ssl http2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name your-domain.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root /var/www/kap-gold/public;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate /path/to/certificate.pem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate_key /path/to/private.key;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_header X-Frame-Options &quot;SAMEORIGIN&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_header X-Content-Type-Options &quot;nosniff&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index index.php;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    charset utf-8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try_files $uri $uri/ /index.php?$query_string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location = /favicon.ico { access_log off; log_not_found off; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location = /robots.txt  { access_log off; log_not_found off; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_page 404 /index.php;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location ~ \.php$ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_pass unix:/var/run/php/php8.0-fpm.sock;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include fastcgi_params;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location ~ /\.(?!well-known).* {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        deny all;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitoring--maintenance">Monitoring &amp; Maintenance<a href="#monitoring--maintenance" class="hash-link" aria-label="Direct link to Monitoring &amp; Maintenance" title="Direct link to Monitoring &amp; Maintenance">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="log-management">Log Management<a href="#log-management" class="hash-link" aria-label="Direct link to Log Management" title="Direct link to Log Management">â€‹</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Set up log rotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo nano /etc/logrotate.d/kap-gold</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/var/www/kap-gold/storage/logs/*.log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    daily</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    missingok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rotate 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delaycompress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    notifempty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create 644 www-data www-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="health-checks">Health Checks<a href="#health-checks" class="hash-link" aria-label="Direct link to Health Checks" title="Direct link to Health Checks">â€‹</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create health check endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route::get(&#x27;/health&#x27;, function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return response()-&gt;json([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27; =&gt; &#x27;healthy&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;database&#x27; =&gt; DB::connection()-&gt;getPdo() ? &#x27;connected&#x27; : &#x27;disconnected&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;cache&#x27; =&gt; Cache::get(&#x27;health_check&#x27;) ? &#x27;working&#x27; : &#x27;failed&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;queue&#x27; =&gt; Queue::size() &lt; 1000 ? &#x27;normal&#x27; : &#x27;high&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;timestamp&#x27; =&gt; now()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="maintenance--support">Maintenance &amp; Support<a href="#maintenance--support" class="hash-link" aria-label="Direct link to Maintenance &amp; Support" title="Direct link to Maintenance &amp; Support">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="regular-maintenance-tasks">Regular Maintenance Tasks<a href="#regular-maintenance-tasks" class="hash-link" aria-label="Direct link to Regular Maintenance Tasks" title="Direct link to Regular Maintenance Tasks">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="daily-tasks">Daily Tasks<a href="#daily-tasks" class="hash-link" aria-label="Direct link to Daily Tasks" title="Direct link to Daily Tasks">â€‹</a></h4>
<ul>
<li>Monitor application logs (<code>storage/logs/laravel.log</code>)</li>
<li>Check queue job status</li>
<li>Verify payment gateway connections</li>
<li>Review failed transactions</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="weekly-tasks">Weekly Tasks<a href="#weekly-tasks" class="hash-link" aria-label="Direct link to Weekly Tasks" title="Direct link to Weekly Tasks">â€‹</a></h4>
<ul>
<li>Database backup and verification</li>
<li>Security log review</li>
<li>Performance monitoring</li>
<li>User feedback review</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="monthly-tasks">Monthly Tasks<a href="#monthly-tasks" class="hash-link" aria-label="Direct link to Monthly Tasks" title="Direct link to Monthly Tasks">â€‹</a></h4>
<ul>
<li>Security updates and patches</li>
<li>Database optimization</li>
<li>Code quality review</li>
<li>Performance analysis</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="development-workflow">Development Workflow<a href="#development-workflow" class="hash-link" aria-label="Direct link to Development Workflow" title="Direct link to Development Workflow">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="code-standards">Code Standards<a href="#code-standards" class="hash-link" aria-label="Direct link to Code Standards" title="Direct link to Code Standards">â€‹</a></h4>
<ul>
<li><strong>PSR-12</strong> PHP coding standards</li>
<li><strong>Blade</strong> template formatting</li>
<li><strong>Consistent naming</strong> conventions</li>
<li><strong>Comprehensive commenting</strong></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="testing-strategy">Testing Strategy<a href="#testing-strategy" class="hash-link" aria-label="Direct link to Testing Strategy" title="Direct link to Testing Strategy">â€‹</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Run tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Coverage report</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan test --coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Specific test suites</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan test --testsuite=Feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php artisan test --testsuite=Unit</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="git-workflow">Git Workflow<a href="#git-workflow" class="hash-link" aria-label="Direct link to Git Workflow" title="Direct link to Git Workflow">â€‹</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Feature development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git checkout -b feature/new-feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit -m &quot;Add new feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push origin feature/new-feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create pull request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Code review required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Merge to development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Deploy to staging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Test and approve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Merge to main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Deploy to production</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="emergency-procedures">Emergency Procedures<a href="#emergency-procedures" class="hash-link" aria-label="Direct link to Emergency Procedures" title="Direct link to Emergency Procedures">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="security-incident-response">Security Incident Response<a href="#security-incident-response" class="hash-link" aria-label="Direct link to Security Incident Response" title="Direct link to Security Incident Response">â€‹</a></h4>
<ol>
<li><strong>Immediate</strong>: Disable affected endpoints</li>
<li><strong>Assess</strong>: Determine scope and impact</li>
<li><strong>Contain</strong>: Prevent further damage</li>
<li><strong>Investigate</strong>: Root cause analysis</li>
<li><strong>Recover</strong>: Restore normal operations</li>
<li><strong>Document</strong>: Incident report and lessons learned</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="payment-gateway-failure">Payment Gateway Failure<a href="#payment-gateway-failure" class="hash-link" aria-label="Direct link to Payment Gateway Failure" title="Direct link to Payment Gateway Failure">â€‹</a></h4>
<ol>
<li><strong>Monitor</strong>: Set up alerts for payment failures</li>
<li><strong>Fallback</strong>: Implement alternative payment methods</li>
<li><strong>Communication</strong>: Notify users of issues</li>
<li><strong>Recovery</strong>: Resume normal operations</li>
<li><strong>Analysis</strong>: Review failure patterns</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="support-contacts">Support Contacts<a href="#support-contacts" class="hash-link" aria-label="Direct link to Support Contacts" title="Direct link to Support Contacts">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="technical-support">Technical Support<a href="#technical-support" class="hash-link" aria-label="Direct link to Technical Support" title="Direct link to Technical Support">â€‹</a></h4>
<ul>
<li><strong>Application</strong>: Internal development team</li>
<li><strong>Database</strong>: Database administrator</li>
<li><strong>Infrastructure</strong>: DevOps team</li>
<li><strong>Security</strong>: Security team</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="business-support">Business Support<a href="#business-support" class="hash-link" aria-label="Direct link to Business Support" title="Direct link to Business Support">â€‹</a></h4>
<ul>
<li><strong>Payment Issues</strong>: ToyyibPay support, Snap N Pay support</li>
<li><strong>SMS Issues</strong>: eSMS support</li>
<li><strong>Business Logic</strong>: Business analyst</li>
<li><strong>User Support</strong>: Customer service team</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-notes">Final Notes<a href="#final-notes" class="hash-link" aria-label="Direct link to Final Notes" title="Direct link to Final Notes">â€‹</a></h2>
<p>This application handles sensitive financial data and requires:</p>
<ul>
<li><strong>Regular security audits</strong></li>
<li><strong>Compliance with Malaysian financial regulations</strong></li>
<li><strong>Proper backup and disaster recovery procedures</strong></li>
<li><strong>Comprehensive monitoring and alerting</strong></li>
<li><strong>Staff training on security best practices</strong></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="immediate-actions-required">Immediate Actions Required<a href="#immediate-actions-required" class="hash-link" aria-label="Direct link to Immediate Actions Required" title="Direct link to Immediate Actions Required">â€‹</a></h3>
<ol>
<li><strong>Fix SQL injection vulnerabilities</strong> (CRITICAL)</li>
<li><strong>Implement payment callback signature verification</strong> (CRITICAL)</li>
<li><strong>Add foreign key constraints</strong> (HIGH)</li>
<li><strong>Enhance authorization checks</strong> (HIGH)</li>
<li><strong>Implement comprehensive logging</strong> (MEDIUM)</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="recommended-next-steps">Recommended Next Steps<a href="#recommended-next-steps" class="hash-link" aria-label="Direct link to Recommended Next Steps" title="Direct link to Recommended Next Steps">â€‹</a></h3>
<ol>
<li><strong>Security audit</strong> by external firm</li>
<li><strong>Penetration testing</strong></li>
<li><strong>Code review</strong> and refactoring</li>
<li><strong>Performance optimization</strong></li>
<li><strong>Comprehensive testing suite</strong></li>
</ol>
<p>This documentation provides a complete overview of the KAP Gold Trading Platform. For specific implementation details, refer to the source code and Laravel documentation.</p>
<hr>
<p><strong>Document Version</strong>: 1.0<br>
<strong>Last Updated</strong>: 2025-01-09<br>
<strong>Prepared By</strong>: Claude Code Analysis<br>
<strong>Review Required</strong>: Senior Developer, Security Team, Business Analyst</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/creative-system-consultant/csc-docs/docs/KAP_DOCUMENTATION.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/csc-docs/docs/pmgi-docs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">TEKUN PMGI Documentation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of Contents</a></li><li><a href="#project-overview" class="table-of-contents__link toc-highlight">Project Overview</a><ul><li><a href="#key-stakeholders" class="table-of-contents__link toc-highlight">Key Stakeholders</a></li><li><a href="#technology-stack" class="table-of-contents__link toc-highlight">Technology Stack</a></li></ul></li><li><a href="#system-architecture" class="table-of-contents__link toc-highlight">System Architecture</a><ul><li><a href="#multi-database-architecture" class="table-of-contents__link toc-highlight">Multi-Database Architecture</a></li><li><a href="#application-layers" class="table-of-contents__link toc-highlight">Application Layers</a></li></ul></li><li><a href="#development-environment-setup" class="table-of-contents__link toc-highlight">Development Environment Setup</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#installation-steps" class="table-of-contents__link toc-highlight">Installation Steps</a></li><li><a href="#environment-variables-env" class="table-of-contents__link toc-highlight">Environment Variables (.env)</a></li></ul></li><li><a href="#authentication--authorization" class="table-of-contents__link toc-highlight">Authentication &amp; Authorization</a><ul><li><a href="#user-role-system" class="table-of-contents__link toc-highlight">User Role System</a></li><li><a href="#authentication-flow" class="table-of-contents__link toc-highlight">Authentication Flow</a></li><li><a href="#key-models" class="table-of-contents__link toc-highlight">Key Models</a></li><li><a href="#middleware-stack" class="table-of-contents__link toc-highlight">Middleware Stack</a></li><li><a href="#security-implementation" class="table-of-contents__link toc-highlight">Security Implementation</a></li></ul></li><li><a href="#core-business-logic" class="table-of-contents__link toc-highlight">Core Business Logic</a><ul><li><a href="#main-business-entities" class="table-of-contents__link toc-highlight">Main Business Entities</a></li><li><a href="#business-processes" class="table-of-contents__link toc-highlight">Business Processes</a></li><li><a href="#ar-rahnu-islamic-pawn-system" class="table-of-contents__link toc-highlight">Ar-Rahnu (Islamic Pawn) System</a></li></ul></li><li><a href="#payment-integration-systems" class="table-of-contents__link toc-highlight">Payment Integration Systems</a><ul><li><a href="#toyyibpay-integration" class="table-of-contents__link toc-highlight">ToyyibPay Integration</a></li><li><a href="#snap-n-pay-integration" class="table-of-contents__link toc-highlight">Snap N Pay Integration</a></li><li><a href="#-critical-security-issue" class="table-of-contents__link toc-highlight">ğŸš¨ <strong>CRITICAL SECURITY ISSUE</strong></a></li></ul></li><li><a href="#frontend-architecture-livewire" class="table-of-contents__link toc-highlight">Frontend Architecture (Livewire)</a><ul><li><a href="#component-structure" class="table-of-contents__link toc-highlight">Component Structure</a></li><li><a href="#key-livewire-components" class="table-of-contents__link toc-highlight">Key Livewire Components</a></li><li><a href="#frontend-technologies" class="table-of-contents__link toc-highlight">Frontend Technologies</a></li></ul></li><li><a href="#database-schema--relationships" class="table-of-contents__link toc-highlight">Database Schema &amp; Relationships</a><ul><li><a href="#core-tables" class="table-of-contents__link toc-highlight">Core Tables</a></li><li><a href="#-critical-database-issue" class="table-of-contents__link toc-highlight">ğŸš¨ <strong>CRITICAL DATABASE ISSUE</strong></a></li><li><a href="#key-relationships" class="table-of-contents__link toc-highlight">Key Relationships</a></li></ul></li><li><a href="#api-endpoints--routes" class="table-of-contents__link toc-highlight">API Endpoints &amp; Routes</a><ul><li><a href="#web-routes-structure" class="table-of-contents__link toc-highlight">Web Routes Structure</a></li><li><a href="#api-endpoints" class="table-of-contents__link toc-highlight">API Endpoints</a></li></ul></li><li><a href="#critical-security-issues" class="table-of-contents__link toc-highlight">Critical Security Issues</a><ul><li><a href="#-immediate-action-required" class="table-of-contents__link toc-highlight">ğŸ”´ <strong>IMMEDIATE ACTION REQUIRED</strong></a></li></ul></li><li><a href="#deployment-guide" class="table-of-contents__link toc-highlight">Deployment Guide</a><ul><li><a href="#production-environment-setup" class="table-of-contents__link toc-highlight">Production Environment Setup</a></li><li><a href="#monitoring--maintenance" class="table-of-contents__link toc-highlight">Monitoring &amp; Maintenance</a></li></ul></li><li><a href="#maintenance--support" class="table-of-contents__link toc-highlight">Maintenance &amp; Support</a><ul><li><a href="#regular-maintenance-tasks" class="table-of-contents__link toc-highlight">Regular Maintenance Tasks</a></li><li><a href="#development-workflow" class="table-of-contents__link toc-highlight">Development Workflow</a></li><li><a href="#emergency-procedures" class="table-of-contents__link toc-highlight">Emergency Procedures</a></li><li><a href="#support-contacts" class="table-of-contents__link toc-highlight">Support Contacts</a></li></ul></li><li><a href="#final-notes" class="table-of-contents__link toc-highlight">Final Notes</a><ul><li><a href="#immediate-actions-required" class="table-of-contents__link toc-highlight">Immediate Actions Required</a></li><li><a href="#recommended-next-steps" class="table-of-contents__link toc-highlight">Recommended Next Steps</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>