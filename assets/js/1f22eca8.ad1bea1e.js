"use strict";(self.webpackChunkcsc_docs=self.webpackChunkcsc_docs||[]).push([[185],{8036:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"kap-docs","title":"Kasih AP Gold Documentation","description":"Table of Contents","source":"@site/docs/KAP_DOCUMENTATION.md","sourceDirName":".","slug":"/kap-docs","permalink":"/csc-docs/docs/kap-docs","draft":false,"unlisted":false,"editUrl":"https://github.com/creative-system-consultant/csc-docs/docs/KAP_DOCUMENTATION.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"kap-docs","title":"Kasih AP Gold Documentation","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"SSM SFMS Documentation","permalink":"/csc-docs/docs/sfms-docs"},"next":{"title":"TEKUN PMGI Documentation","permalink":"/csc-docs/docs/pmgi-docs"}}');var s=r(4848),t=r(8453);const l={id:"kap-docs",title:"Kasih AP Gold Documentation",sidebar_position:2},a="KAP (Kasih AP Gold) Trading Platform Documentation",o={},c=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Project Overview",id:"project-overview",level:2},{value:"Key Stakeholders",id:"key-stakeholders",level:3},{value:"Technology Stack",id:"technology-stack",level:3},{value:"System Architecture",id:"system-architecture",level:2},{value:"Multi-Database Architecture",id:"multi-database-architecture",level:3},{value:"Application Layers",id:"application-layers",level:3},{value:"Development Environment Setup",id:"development-environment-setup",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Installation Steps",id:"installation-steps",level:3},{value:"Environment Variables (.env)",id:"environment-variables-env",level:3},{value:"Authentication &amp; Authorization",id:"authentication--authorization",level:2},{value:"User Role System",id:"user-role-system",level:3},{value:"Authentication Flow",id:"authentication-flow",level:3},{value:"Key Models",id:"key-models",level:3},{value:"Middleware Stack",id:"middleware-stack",level:3},{value:"Security Implementation",id:"security-implementation",level:3},{value:"Core Business Logic",id:"core-business-logic",level:2},{value:"Main Business Entities",id:"main-business-entities",level:3},{value:"Gold Trading System",id:"gold-trading-system",level:4},{value:"Commission System",id:"commission-system",level:4},{value:"Inventory Management",id:"inventory-management",level:4},{value:"Business Processes",id:"business-processes",level:3},{value:"Gold Purchase Flow",id:"gold-purchase-flow",level:4},{value:"Commission Calculation",id:"commission-calculation",level:4},{value:"Ar-Rahnu (Islamic Pawn) System",id:"ar-rahnu-islamic-pawn-system",level:3},{value:"Payment Integration Systems",id:"payment-integration-systems",level:2},{value:"ToyyibPay Integration",id:"toyyibpay-integration",level:3},{value:"Configuration",id:"configuration",level:4},{value:"Bill Creation",id:"bill-creation",level:4},{value:"Callback Processing",id:"callback-processing",level:4},{value:"Snap N Pay Integration",id:"snap-n-pay-integration",level:3},{value:"Configuration",id:"configuration-1",level:4},{value:"\ud83d\udea8 <strong>CRITICAL SECURITY ISSUE</strong>",id:"-critical-security-issue",level:3},{value:"Frontend Architecture (Livewire)",id:"frontend-architecture-livewire",level:2},{value:"Component Structure",id:"component-structure",level:3},{value:"Key Livewire Components",id:"key-livewire-components",level:3},{value:"Digital Gold Trading",id:"digital-gold-trading",level:4},{value:"Real-time Auction System",id:"real-time-auction-system",level:4},{value:"Frontend Technologies",id:"frontend-technologies",level:3},{value:"Database Schema &amp; Relationships",id:"database-schema--relationships",level:2},{value:"Core Tables",id:"core-tables",level:3},{value:"User Management",id:"user-management",level:4},{value:"Gold Trading",id:"gold-trading",level:4},{value:"\ud83d\udea8 <strong>CRITICAL DATABASE ISSUE</strong>",id:"-critical-database-issue",level:3},{value:"Key Relationships",id:"key-relationships",level:3},{value:"API Endpoints &amp; Routes",id:"api-endpoints--routes",level:2},{value:"Web Routes Structure",id:"web-routes-structure",level:3},{value:"API Endpoints",id:"api-endpoints",level:3},{value:"Critical Security Issues",id:"critical-security-issues",level:2},{value:"\ud83d\udd34 <strong>IMMEDIATE ACTION REQUIRED</strong>",id:"-immediate-action-required",level:3},{value:"1. SQL Injection Vulnerabilities",id:"1-sql-injection-vulnerabilities",level:4},{value:"2. Payment Callback Vulnerabilities",id:"2-payment-callback-vulnerabilities",level:4},{value:"3. Authorization Bypass",id:"3-authorization-bypass",level:4},{value:"4. CSRF Protection Bypass",id:"4-csrf-protection-bypass",level:4},{value:"5. Database Foreign Key Constraints Missing",id:"5-database-foreign-key-constraints-missing",level:4},{value:"Deployment Guide",id:"deployment-guide",level:2},{value:"Production Environment Setup",id:"production-environment-setup",level:3},{value:"Server Requirements",id:"server-requirements",level:4},{value:"Deployment Steps",id:"deployment-steps",level:4},{value:"Monitoring &amp; Maintenance",id:"monitoring--maintenance",level:3},{value:"Log Management",id:"log-management",level:4},{value:"Health Checks",id:"health-checks",level:4},{value:"Maintenance &amp; Support",id:"maintenance--support",level:2},{value:"Regular Maintenance Tasks",id:"regular-maintenance-tasks",level:3},{value:"Daily Tasks",id:"daily-tasks",level:4},{value:"Weekly Tasks",id:"weekly-tasks",level:4},{value:"Monthly Tasks",id:"monthly-tasks",level:4},{value:"Development Workflow",id:"development-workflow",level:3},{value:"Code Standards",id:"code-standards",level:4},{value:"Testing Strategy",id:"testing-strategy",level:4},{value:"Git Workflow",id:"git-workflow",level:4},{value:"Emergency Procedures",id:"emergency-procedures",level:3},{value:"Security Incident Response",id:"security-incident-response",level:4},{value:"Payment Gateway Failure",id:"payment-gateway-failure",level:4},{value:"Support Contacts",id:"support-contacts",level:3},{value:"Technical Support",id:"technical-support",level:4},{value:"Business Support",id:"business-support",level:4},{value:"Final Notes",id:"final-notes",level:2},{value:"Immediate Actions Required",id:"immediate-actions-required",level:3},{value:"Recommended Next Steps",id:"recommended-next-steps",level:3}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"kap-kasih-ap-gold-trading-platform-documentation",children:"KAP (Kasih AP Gold) Trading Platform Documentation"})}),"\n",(0,s.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#project-overview",children:"Project Overview"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#system-architecture",children:"System Architecture"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#development-environment-setup",children:"Development Environment Setup"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#authentication--authorization",children:"Authentication & Authorization"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#core-business-logic",children:"Core Business Logic"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#payment-integration-systems",children:"Payment Integration Systems"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#frontend-architecture-livewire",children:"Frontend Architecture (Livewire)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#database-schema--relationships",children:"Database Schema & Relationships"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#api-endpoints--routes",children:"API Endpoints & Routes"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#critical-security-issues",children:"Critical Security Issues"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#deployment-guide",children:"Deployment Guide"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#maintenance--support",children:"Maintenance & Support"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"project-overview",children:"Project Overview"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"KAP (Kasih AP Gold)"})," is a comprehensive Malaysian gold trading platform built with Laravel 8, offering:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Digital and physical gold trading"}),"\n",(0,s.jsx)(n.li,{children:"Multi-level marketing (MLM) agent structure"}),"\n",(0,s.jsx)(n.li,{children:"Islamic pawn services (Ar-Rahnu)"}),"\n",(0,s.jsx)(n.li,{children:"Commission management system"}),"\n",(0,s.jsx)(n.li,{children:"Real-time auction system (Lelongan)"}),"\n",(0,s.jsx)(n.li,{children:"Multiple payment gateway integrations"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"key-stakeholders",children:"Key Stakeholders"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Kasih Gold"}),": Primary client (client_id = 1)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Kasih AP Gold"}),": Secondary client (client_id = 2)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Agents"}),": Multi-tier marketing structure"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Customers"}),": End users trading gold"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Backend"}),": Laravel 8, PHP 7.3+"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Frontend"}),": Livewire 2, Alpine.js, Tailwind CSS"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database"}),": MySQL (primary), SQL Server (Arrahnu system)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Real-time"}),": Laravel WebSockets, Pusher"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Payment"}),": ToyyibPay, Snap N Pay"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Queue"}),": Redis/Database"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Email"}),": SMTP with custom templates"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"system-architecture",children:"System Architecture"}),"\n",(0,s.jsx)(n.h3,{id:"multi-database-architecture",children:"Multi-Database Architecture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502   Primary DB    \u2502    \u2502   ArrahnuDB     \u2502    \u2502   External APIs \u2502\r\n\u2502   (MySQL)       \u2502    \u2502  (SQL Server)   \u2502    \u2502   (Payment)     \u2502\r\n\u2502                 \u2502    \u2502                 \u2502    \u2502                 \u2502\r\n\u2502 \u2022 Users         \u2502    \u2502 \u2022 Pawn Records  \u2502    \u2502 \u2022 ToyyibPay     \u2502\r\n\u2502 \u2022 Gold Trading  \u2502    \u2502 \u2022 Auctions      \u2502    \u2502 \u2022 SnapNPay      \u2502\r\n\u2502 \u2022 Commissions   \u2502    \u2502 \u2022 Branches      \u2502    \u2502 \u2022 eSMS          \u2502\r\n\u2502 \u2022 Inventory     \u2502    \u2502 \u2022 Daily Prices  \u2502    \u2502 \u2022 Market Prices \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h3,{id:"application-layers",children:"Application Layers"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Presentation Layer"}),": Livewire components + Blade templates"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Business Logic Layer"}),": Controllers, Services, and Models"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Access Layer"}),": Eloquent ORM, Raw SQL (for complex queries)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Integration Layer"}),": Payment gateways, SMS services, external APIs"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"development-environment-setup",children:"Development Environment Setup"}),"\n",(0,s.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PHP 7.3+ (with extensions: mbstring, openssl, PDO, Tokenizer, XML, JSON)"}),"\n",(0,s.jsx)(n.li,{children:"Node.js 12+ and NPM"}),"\n",(0,s.jsx)(n.li,{children:"MySQL 5.7+ or MariaDB 10.3+"}),"\n",(0,s.jsx)(n.li,{children:"Redis (optional, for queues)"}),"\n",(0,s.jsx)(n.li,{children:"Composer 2.0+"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"installation-steps",children:"Installation Steps"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Clone and Install Dependencies"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone <repository-url>\r\ncd kap\r\ncomposer install\r\nnpm install\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Environment Configuration"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cp .env.example .env\r\nphp artisan key:generate\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Database Setup"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Create database\r\nmysql -u root -p -e "CREATE DATABASE kap_gold;"\r\n\r\n# Run migrations\r\nphp artisan migrate\r\n\r\n# Seed database\r\nphp artisan db:seed\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Build Assets"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm run dev          # Development\r\nnpm run watch        # Watch for changes\r\nnpm run prod         # Production\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Development Server"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"php artisan serve\r\nphp artisan queue:work    # For background jobs\n"})}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables-env",children:"Environment Variables (.env)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-env",children:'APP_NAME="KAP Gold Trading"\r\nAPP_ENV=local\r\nAPP_DEBUG=true\r\nAPP_URL=http://localhost:8000\r\n\r\nDB_CONNECTION=mysql\r\nDB_HOST=127.0.0.1\r\nDB_DATABASE=kap_gold\r\nDB_USERNAME=root\r\nDB_PASSWORD=\r\n\r\n# Payment Gateway\r\nTOYYIBPAY_API_KEY=your_api_key\r\nTOYYIBPAY_CATEGORY_CODE=your_category_code\r\n\r\n# SMS Service\r\nESMS_API_KEY=your_esms_key\r\nESMS_USERNAME=your_username\r\nESMS_PASSWORD=your_password\r\n\r\n# WebSocket\r\nPUSHER_APP_ID=your_app_id\r\nPUSHER_APP_KEY=your_app_key\r\nPUSHER_APP_SECRET=your_app_secret\r\nPUSHER_APP_CLUSTER=mt1\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"authentication--authorization",children:"Authentication & Authorization"}),"\n",(0,s.jsx)(n.h3,{id:"user-role-system",children:"User Role System"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// User roles in database\r\n1 => 'Administrator'\r\n2 => 'Master Dealer'\r\n3 => 'Premium Agent (Agent)'\r\n4 => 'Agent (User registration default)'\r\n5 => 'Retail - VVIP'\r\n6 => 'Retail - Public'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"authentication-flow",children:"Authentication Flow"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Registration"}),": Creates user with role=4, requires referral code"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OTP Verification"}),": SMS-based verification via eSMS API"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Profile Completion"}),": Required before system access"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Screening"}),": Admin approval process for full access"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"key-models",children:"Key Models"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User"}),": Core authentication entity"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Roles"}),": Role definitions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Profile_personal"}),": Personal information"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Profile_bank_info"}),": Banking details"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ReferralCode"}),": Referral tracking"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"middleware-stack",children:"Middleware Stack"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Route protection layers\r\n'auth' => Authenticate::class,\r\n'auth.admin' => AuthAdmin::class,\r\n'verified.otp' => VerifiedOTP::class,\r\n'passScreen' => PassScreening::class,\n"})}),"\n",(0,s.jsx)(n.h3,{id:"security-implementation",children:"Security Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// User model role checks\r\npublic function isAdminKAP(): bool\r\n{\r\n    return $this->client == 2 && $this->role == 1;\r\n}\r\n\r\npublic function isAgentKAP(): bool\r\n{\r\n    return $this->client == 2 && $this->role == 3;\r\n}\r\n\r\npublic function isUserKAP(): bool\r\n{\r\n    return $this->client == 2 && $this->role == 4;\r\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"core-business-logic",children:"Core Business Logic"}),"\n",(0,s.jsx)(n.h3,{id:"main-business-entities",children:"Main Business Entities"}),"\n",(0,s.jsx)(n.h4,{id:"gold-trading-system",children:"Gold Trading System"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Goldbar"}),": Physical gold inventory with weight tracking"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"GoldbarOwnership"}),": User ownership of gold portions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"GoldbarOwnershipPending"}),": Pending ownership transfers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"MarketPrice"}),": Current market pricing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SpotGoldPricing"}),": Weight-based pricing tiers"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"commission-system",children:"Commission System"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CommissionRate"}),": Base commission rates"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CommissionDetail"}),": Individual commission records"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CommissionRateKap"}),": KAP-specific rates"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CommissionDetailKap"}),": KAP commission tracking"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"inventory-management",children:"Inventory Management"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"InvItem"}),": Product catalog"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"InvMaster"}),": Individual item instances"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"InvMovement"}),": Stock movement tracking"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"InvCart"}),": Shopping cart functionality"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"business-processes",children:"Business Processes"}),"\n",(0,s.jsx)(n.h4,{id:"gold-purchase-flow",children:"Gold Purchase Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// 1. Add to cart\r\nInvCart::create([\r\n    'user_id' => $user->id,\r\n    'item_id' => $item->id,\r\n    'quantity' => $quantity,\r\n    'price' => $calculated_price\r\n]);\r\n\r\n// 2. Payment processing\r\n$payment = ToyyibPay::createBill([\r\n    'amount' => $total_amount,\r\n    'reference' => $unique_reference\r\n]);\r\n\r\n// 3. Create pending ownership\r\nGoldbarOwnershipPending::create([\r\n    'user_id' => $user->id,\r\n    'weight' => $weight,\r\n    'bought_price' => $price,\r\n    'status' => 2 // Pending\r\n]);\r\n\r\n// 4. Reserve gold\r\n$goldbar->update([\r\n    'weight_on_hold' => $goldbar->weight_on_hold + $weight\r\n]);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"commission-calculation",children:"Commission Calculation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Agent commission reduces purchase price\r\n$commission = CommissionRate::where('item_id', $item->id)->first();\r\n$final_price = $market_price - $commission->agent_rate;\r\n\r\n// Spot gold pricing\r\n$spot_percentage = SpotGoldPricing::getPercentage($weight);\r\n$spot_price = ($market_price + ($market_price * $spot_percentage)) * $weight;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ar-rahnu-islamic-pawn-system",children:"Ar-Rahnu (Islamic Pawn) System"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Separate SQL Server Database"})," (arrahnudb)"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Quarterly payment structure"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Auction system for defaults"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Branch-based operations"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Sharia-compliant processes"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"payment-integration-systems",children:"Payment Integration Systems"}),"\n",(0,s.jsx)(n.h3,{id:"toyyibpay-integration",children:"ToyyibPay Integration"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Primary Malaysian payment gateway"})}),"\n",(0,s.jsx)(n.h4,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// config/toyyibpay.php\r\n'api_key' => env('TOYYIBPAY_API_KEY'),\r\n'category_code' => env('TOYYIBPAY_CATEGORY_CODE'),\r\n'endpoint' => 'https://dev.toyyibpay.com/index.php/api/createBill'\n"})}),"\n",(0,s.jsx)(n.h4,{id:"bill-creation",children:"Bill Creation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// ToyyibpayController@createBill\r\n$bill = [\r\n    'userSecretKey' => config('toyyibpay.api_key'),\r\n    'categoryCode' => config('toyyibpay.category_code'),\r\n    'billName' => 'Gold Purchase',\r\n    'billDescription' => 'Digital Gold Purchase',\r\n    'billAmount' => $amount,\r\n    'billReturnUrl' => route('toyyibpay-status'),\r\n    'billCallbackUrl' => route('toyyibpay-callback'),\r\n    'billPayorEmail' => $user->email\r\n];\n"})}),"\n",(0,s.jsx)(n.h4,{id:"callback-processing",children:"Callback Processing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Callback endpoints\r\nRoute::post('toyyibpay-callback', [ToyyibpayController::class, 'callback']);\r\nRoute::post('toyyibpay-callback-mint', [ToyyibpayController::class, 'callbackMint']);\r\nRoute::post('toyyibpay-callbackConv', [ToyyibpayController::class, 'callbackConv']);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"snap-n-pay-integration",children:"Snap N Pay Integration"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Alternative payment provider"})}),"\n",(0,s.jsx)(n.h4,{id:"configuration-1",children:"Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Production endpoint\r\n'endpoint' => 'https://prod.snapnpay.co/payments/api'\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"-critical-security-issue",children:["\ud83d\udea8 ",(0,s.jsx)(n.strong,{children:"CRITICAL SECURITY ISSUE"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Payment callback endpoints lack cryptographic signature verification, making them vulnerable to spoofing attacks."})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"frontend-architecture-livewire",children:"Frontend Architecture (Livewire)"}),"\n",(0,s.jsx)(n.h3,{id:"component-structure",children:"Component Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"app/Http/Livewire/\r\n\u251c\u2500\u2500 Auth/                    # Authentication components\r\n\u2502   \u251c\u2500\u2500 Login.php\r\n\u2502   \u251c\u2500\u2500 Register.php\r\n\u2502   \u2514\u2500\u2500 VerifyOtp.php\r\n\u251c\u2500\u2500 Page/                    # Main application pages\r\n\u2502   \u251c\u2500\u2500 Admin/              # Admin interface\r\n\u2502   \u251c\u2500\u2500 DigitalGold/        # Gold trading\r\n\u2502   \u251c\u2500\u2500 PhysicalGold/       # Physical gold conversion\r\n\u2502   \u251c\u2500\u2500 Cart/               # Shopping cart\r\n\u2502   \u251c\u2500\u2500 Lelongan/          # Auction system\r\n\u2502   \u2514\u2500\u2500 Reporting/         # Business intelligence\n"})}),"\n",(0,s.jsx)(n.h3,{id:"key-livewire-components",children:"Key Livewire Components"}),"\n",(0,s.jsx)(n.h4,{id:"digital-gold-trading",children:"Digital Gold Trading"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// DigitalGold.php - Main trading interface\r\nclass DigitalGold extends Component\r\n{\r\n    public $userGold, $portfolio, $marketPrice;\r\n    \r\n    public function mount()\r\n    {\r\n        $this->userGold = GoldbarOwnership::where('user_id', auth()->id())\r\n                                         ->where('active_ownership', 1)\r\n                                         ->sum('weight');\r\n    }\r\n    \r\n    public function render()\r\n    {\r\n        return view('livewire.page.digital-gold.digital-gold');\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"real-time-auction-system",children:"Real-time Auction System"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Lelongan.php - Auction bidding\r\nclass Lelongan extends Component\r\n{\r\n    public $currentBid, $bidAmount;\r\n    \r\n    public function placeBid()\r\n    {\r\n        // Real-time bid processing\r\n        event(new BidPlaced($this->bidAmount, auth()->user()));\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"frontend-technologies",children:"Frontend Technologies"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tailwind CSS"}),": Utility-first CSS framework"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Alpine.js"}),": Lightweight JavaScript framework"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ApexCharts"}),": Data visualization"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"WebSockets"}),": Real-time features (auctions, notifications)"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"database-schema--relationships",children:"Database Schema & Relationships"}),"\n",(0,s.jsx)(n.h3,{id:"core-tables",children:"Core Tables"}),"\n",(0,s.jsx)(n.h4,{id:"user-management",children:"User Management"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE users (\r\n    id BIGINT PRIMARY KEY AUTO_INCREMENT,\r\n    name VARCHAR(255) NOT NULL,\r\n    email VARCHAR(255) UNIQUE NOT NULL,\r\n    password VARCHAR(255) NOT NULL,\r\n    role INT NOT NULL DEFAULT 4,\r\n    type INT NOT NULL DEFAULT 1,\r\n    client INT NOT NULL DEFAULT 2,\r\n    active TINYINT NOT NULL DEFAULT 1,\r\n    otp_verified_at TIMESTAMP NULL,\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"gold-trading",children:"Gold Trading"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE goldbar (\r\n    id BIGINT PRIMARY KEY AUTO_INCREMENT,\r\n    guid VARCHAR(255) UNIQUE,\r\n    bought_price DECIMAL(10,2),\r\n    total_weight DECIMAL(10,2),\r\n    weight_occupied DECIMAL(10,2) DEFAULT 0,\r\n    weight_on_hold DECIMAL(10,2) DEFAULT 0,\r\n    weight_vacant DECIMAL(10,2),\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\r\n\r\nCREATE TABLE goldbar_ownership (\r\n    id BIGINT PRIMARY KEY AUTO_INCREMENT,\r\n    user_id BIGINT,\r\n    goldbar_id BIGINT,\r\n    weight DECIMAL(10,2),\r\n    bought_price DECIMAL(10,2),\r\n    active_ownership TINYINT DEFAULT 1,\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"-critical-database-issue",children:["\ud83d\udea8 ",(0,s.jsx)(n.strong,{children:"CRITICAL DATABASE ISSUE"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Missing foreign key constraints across all tables, risking data integrity"})}),"\n",(0,s.jsx)(n.h3,{id:"key-relationships",children:"Key Relationships"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// User Model relationships\r\npublic function goldOwnership()\r\n{\r\n    return $this->hasMany(GoldbarOwnership::class);\r\n}\r\n\r\npublic function upline()\r\n{\r\n    return $this->hasOne(UserUpline::class);\r\n}\r\n\r\npublic function downlines()\r\n{\r\n    return $this->hasMany(UserDownline::class);\r\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"api-endpoints--routes",children:"API Endpoints & Routes"}),"\n",(0,s.jsx)(n.h3,{id:"web-routes-structure",children:"Web Routes Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Guest routes\r\nRoute::middleware('guest')->group(function () {\r\n    Route::get('login', Login::class)->name('login');\r\n    Route::get('register/{code}', Register::class)->name('register');\r\n    Route::post('toyyibpay-callback', [ToyyibpayController::class, 'callback']);\r\n});\r\n\r\n// Authenticated routes\r\nRoute::middleware('auth')->group(function () {\r\n    Route::middleware(['passScreen', 'verified.otp'])->group(function () {\r\n        Route::get('home', [DashboardController::class, 'index'])->name('home');\r\n        Route::get('digital-gold', [DigitalGoldController::class, 'index']);\r\n        Route::get('physical-gold', [PhysicalGoldController::class, 'index']);\r\n    });\r\n    \r\n    // Admin routes\r\n    Route::middleware('auth.admin')->group(function () {\r\n        Route::get('admin/user-management', UserManagement::class);\r\n        Route::get('reporting/gold-report', GoldReport::class);\r\n    });\r\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// api.php\r\nRoute::post('/login', [AuthController::class, 'login']);\r\nRoute::post('/register', [AuthController::class, 'register']);\r\nRoute::get('/market-price', [MarketPriceController::class, 'index']);\r\n\r\nRoute::middleware('auth:sanctum')->group(function () {\r\n    Route::post('/logout', [AuthController::class, 'logout']);\r\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"critical-security-issues",children:"Critical Security Issues"}),"\n",(0,s.jsxs)(n.h3,{id:"-immediate-action-required",children:["\ud83d\udd34 ",(0,s.jsx)(n.strong,{children:"IMMEDIATE ACTION REQUIRED"})]}),"\n",(0,s.jsx)(n.h4,{id:"1-sql-injection-vulnerabilities",children:"1. SQL Injection Vulnerabilities"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"app/Http/Controllers/ReportingController.php"}),"\r\n",(0,s.jsx)(n.strong,{children:"Lines"}),": 53-59, 74-82, 84-92"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// VULNERABLE CODE\r\n$data = DB::select(\"select user_id, CAST(YEAR(created_at) AS VARCHAR(4)) + '-' + CAST(MONTH(created_at) AS VARCHAR(2)) AS date, SUM(commission) AS commission, status\r\n                    FROM commission_detail_kaps\r\n                    where user_id = '\".$agent.\"'\r\n                        and CAST (created_at as date) >= '\". $date->startOfMonth()->toDateString() . \"'\");\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Fix Required"}),": Use parameterized queries"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// SECURE CODE\r\n$data = DB::select(\"SELECT user_id, CAST(YEAR(created_at) AS VARCHAR(4)) + '-' + CAST(MONTH(created_at) AS VARCHAR(2)) AS date, SUM(commission) AS commission, status\r\n                    FROM commission_detail_kaps\r\n                    WHERE user_id = ?\r\n                        AND CAST(created_at AS DATE) >= ?\", [$agent, $date->startOfMonth()->toDateString()]);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-payment-callback-vulnerabilities",children:"2. Payment Callback Vulnerabilities"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"app/Http/Controllers/ToyyibpayController.php"}),"\r\n",(0,s.jsx)(n.strong,{children:"Issue"}),": No signature verification for payment callbacks"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Fix Required"}),": Implement webhook signature validation"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"public function callback(Request $request)\r\n{\r\n    // Verify webhook signature\r\n    $signature = $request->header('X-Signature');\r\n    $payload = $request->getContent();\r\n    $expectedSignature = hash_hmac('sha256', $payload, config('toyyibpay.webhook_secret'));\r\n    \r\n    if (!hash_equals($signature, $expectedSignature)) {\r\n        return response()->json(['error' => 'Invalid signature'], 401);\r\n    }\r\n    \r\n    // Process payment...\r\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"3-authorization-bypass",children:"3. Authorization Bypass"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"app/Http/Controllers/ProfileController.php"}),"\r\n",(0,s.jsx)(n.strong,{children:"Lines"}),": 24-33, 35-44"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// VULNERABLE CODE\r\npublic function deleteIcFront($id)\r\n{\r\n    Profile_personal::where('user_id', $id)->update([\r\n        'ic_front' => NULL,\r\n    ]);\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Fix Required"}),": Add authorization check"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// SECURE CODE\r\npublic function deleteIcFront($id)\r\n{\r\n    $user = auth()->user();\r\n    if ($user->id != $id && !$user->isAdminKAP()) {\r\n        abort(403, 'Unauthorized');\r\n    }\r\n    \r\n    Profile_personal::where('user_id', $id)->update([\r\n        'ic_front' => NULL,\r\n    ]);\r\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"4-csrf-protection-bypass",children:"4. CSRF Protection Bypass"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"app/Http/Middleware/VerifyCsrfToken.php"}),"\r\n",(0,s.jsx)(n.strong,{children:"Issue"}),": Critical payment endpoints excluded from CSRF protection"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Fix Required"}),": Implement alternative protection for payment callbacks"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Use signed URLs or token validation for payment callbacks\r\nprotected $except = [\r\n    // Remove payment endpoints\r\n];\n"})}),"\n",(0,s.jsx)(n.h4,{id:"5-database-foreign-key-constraints-missing",children:"5. Database Foreign Key Constraints Missing"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"All Migration Files"}),"\r\n",(0,s.jsx)(n.strong,{children:"Issue"}),": No foreign key constraints defined"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Fix Required"}),": Add foreign key constraints"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// In migrations\r\nSchema::table('goldbar_ownership', function (Blueprint $table) {\r\n    $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');\r\n    $table->foreign('goldbar_id')->references('id')->on('goldbar')->onDelete('cascade');\r\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"deployment-guide",children:"Deployment Guide"}),"\n",(0,s.jsx)(n.h3,{id:"production-environment-setup",children:"Production Environment Setup"}),"\n",(0,s.jsx)(n.h4,{id:"server-requirements",children:"Server Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PHP 8.0+"})," with required extensions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"MySQL 8.0+"})," or MariaDB 10.5+"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Redis"})," for caching and queues"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Nginx/Apache"})," web server"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SSL certificate"})," (required for payment gateways)"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"deployment-steps",children:"Deployment Steps"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Server Preparation"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install dependencies\r\nsudo apt update\r\nsudo apt install php8.0-fpm php8.0-mysql php8.0-redis nginx redis-server\r\n\r\n# Configure PHP\r\nsudo nano /etc/php/8.0/fpm/php.ini\r\n# Set memory_limit = 256M\r\n# Set upload_max_filesize = 10M\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Application Deployment"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Clone repository\r\ngit clone <repo-url> /var/www/kap-gold\r\ncd /var/www/kap-gold\r\n\r\n# Install dependencies\r\ncomposer install --no-dev --optimize-autoloader\r\nnpm install && npm run production\r\n\r\n# Set permissions\r\nsudo chown -R www-data:www-data /var/www/kap-gold\r\nsudo chmod -R 755 /var/www/kap-gold/storage\r\nsudo chmod -R 755 /var/www/kap-gold/bootstrap/cache\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Environment Configuration"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-env",children:"APP_ENV=production\r\nAPP_DEBUG=false\r\nAPP_URL=https://your-domain.com\r\n\r\n# Database\r\nDB_CONNECTION=mysql\r\nDB_HOST=localhost\r\nDB_DATABASE=kap_gold_prod\r\nDB_USERNAME=kap_user\r\nDB_PASSWORD=secure_password\r\n\r\n# Cache & Queue\r\nCACHE_DRIVER=redis\r\nQUEUE_CONNECTION=redis\r\nSESSION_DRIVER=redis\r\n\r\n# Mail\r\nMAIL_MAILER=smtp\r\nMAIL_HOST=your-smtp-server\r\nMAIL_PORT=587\r\nMAIL_USERNAME=your-email\r\nMAIL_PASSWORD=your-password\r\nMAIL_ENCRYPTION=tls\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Database Migration"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Run migrations\r\nphp artisan migrate --force\r\n\r\n# Seed production data\r\nphp artisan db:seed --class=ProductionSeeder\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Queue Workers"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install supervisor\r\nsudo apt install supervisor\r\n\r\n# Create worker configuration\r\nsudo nano /etc/supervisor/conf.d/kap-worker.conf\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"[program:kap-worker]\r\nprocess_name=%(program_name)s_%(process_num)02d\r\ncommand=php /var/www/kap-gold/artisan queue:work redis --sleep=3 --tries=3\r\nautostart=true\r\nautorestart=true\r\nuser=www-data\r\nnumprocs=2\r\nredirect_stderr=true\r\nstdout_logfile=/var/www/kap-gold/storage/logs/worker.log\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"6",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Web Server Configuration"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-nginx",children:'server {\r\n    listen 80;\r\n    server_name your-domain.com;\r\n    return 301 https://$server_name$request_uri;\r\n}\r\n\r\nserver {\r\n    listen 443 ssl http2;\r\n    server_name your-domain.com;\r\n    root /var/www/kap-gold/public;\r\n\r\n    ssl_certificate /path/to/certificate.pem;\r\n    ssl_certificate_key /path/to/private.key;\r\n\r\n    add_header X-Frame-Options "SAMEORIGIN";\r\n    add_header X-Content-Type-Options "nosniff";\r\n\r\n    index index.php;\r\n\r\n    charset utf-8;\r\n\r\n    location / {\r\n        try_files $uri $uri/ /index.php?$query_string;\r\n    }\r\n\r\n    location = /favicon.ico { access_log off; log_not_found off; }\r\n    location = /robots.txt  { access_log off; log_not_found off; }\r\n\r\n    error_page 404 /index.php;\r\n\r\n    location ~ \\.php$ {\r\n        fastcgi_pass unix:/var/run/php/php8.0-fpm.sock;\r\n        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;\r\n        include fastcgi_params;\r\n    }\r\n\r\n    location ~ /\\.(?!well-known).* {\r\n        deny all;\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"monitoring--maintenance",children:"Monitoring & Maintenance"}),"\n",(0,s.jsx)(n.h4,{id:"log-management",children:"Log Management"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Set up log rotation\r\nsudo nano /etc/logrotate.d/kap-gold\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"/var/www/kap-gold/storage/logs/*.log {\r\n    daily\r\n    missingok\r\n    rotate 30\r\n    compress\r\n    delaycompress\r\n    notifempty\r\n    create 644 www-data www-data\r\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"health-checks",children:"Health Checks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create health check endpoint\r\nRoute::get('/health', function () {\r\n    return response()->json([\r\n        'status' => 'healthy',\r\n        'database' => DB::connection()->getPdo() ? 'connected' : 'disconnected',\r\n        'cache' => Cache::get('health_check') ? 'working' : 'failed',\r\n        'queue' => Queue::size() < 1000 ? 'normal' : 'high',\r\n        'timestamp' => now()\r\n    ]);\r\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"maintenance--support",children:"Maintenance & Support"}),"\n",(0,s.jsx)(n.h3,{id:"regular-maintenance-tasks",children:"Regular Maintenance Tasks"}),"\n",(0,s.jsx)(n.h4,{id:"daily-tasks",children:"Daily Tasks"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Monitor application logs (",(0,s.jsx)(n.code,{children:"storage/logs/laravel.log"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Check queue job status"}),"\n",(0,s.jsx)(n.li,{children:"Verify payment gateway connections"}),"\n",(0,s.jsx)(n.li,{children:"Review failed transactions"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"weekly-tasks",children:"Weekly Tasks"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Database backup and verification"}),"\n",(0,s.jsx)(n.li,{children:"Security log review"}),"\n",(0,s.jsx)(n.li,{children:"Performance monitoring"}),"\n",(0,s.jsx)(n.li,{children:"User feedback review"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"monthly-tasks",children:"Monthly Tasks"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Security updates and patches"}),"\n",(0,s.jsx)(n.li,{children:"Database optimization"}),"\n",(0,s.jsx)(n.li,{children:"Code quality review"}),"\n",(0,s.jsx)(n.li,{children:"Performance analysis"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"development-workflow",children:"Development Workflow"}),"\n",(0,s.jsx)(n.h4,{id:"code-standards",children:"Code Standards"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PSR-12"})," PHP coding standards"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Blade"})," template formatting"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consistent naming"})," conventions"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Comprehensive commenting"})}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"testing-strategy",children:"Testing Strategy"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Run tests\r\nphp artisan test\r\n\r\n# Coverage report\r\nphp artisan test --coverage\r\n\r\n# Specific test suites\r\nphp artisan test --testsuite=Feature\r\nphp artisan test --testsuite=Unit\n"})}),"\n",(0,s.jsx)(n.h4,{id:"git-workflow",children:"Git Workflow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Feature development\r\ngit checkout -b feature/new-feature\r\ngit commit -m "Add new feature"\r\ngit push origin feature/new-feature\r\n\r\n# Create pull request\r\n# Code review required\r\n# Merge to development\r\n# Deploy to staging\r\n# Test and approve\r\n# Merge to main\r\n# Deploy to production\n'})}),"\n",(0,s.jsx)(n.h3,{id:"emergency-procedures",children:"Emergency Procedures"}),"\n",(0,s.jsx)(n.h4,{id:"security-incident-response",children:"Security Incident Response"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Immediate"}),": Disable affected endpoints"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Assess"}),": Determine scope and impact"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Contain"}),": Prevent further damage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Investigate"}),": Root cause analysis"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Recover"}),": Restore normal operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Document"}),": Incident report and lessons learned"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"payment-gateway-failure",children:"Payment Gateway Failure"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitor"}),": Set up alerts for payment failures"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fallback"}),": Implement alternative payment methods"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Communication"}),": Notify users of issues"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Recovery"}),": Resume normal operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Analysis"}),": Review failure patterns"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"support-contacts",children:"Support Contacts"}),"\n",(0,s.jsx)(n.h4,{id:"technical-support",children:"Technical Support"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Application"}),": Internal development team"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database"}),": Database administrator"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Infrastructure"}),": DevOps team"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security"}),": Security team"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"business-support",children:"Business Support"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Payment Issues"}),": ToyyibPay support, Snap N Pay support"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SMS Issues"}),": eSMS support"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Business Logic"}),": Business analyst"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User Support"}),": Customer service team"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"final-notes",children:"Final Notes"}),"\n",(0,s.jsx)(n.p,{children:"This application handles sensitive financial data and requires:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Regular security audits"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Compliance with Malaysian financial regulations"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Proper backup and disaster recovery procedures"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Comprehensive monitoring and alerting"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Staff training on security best practices"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"immediate-actions-required",children:"Immediate Actions Required"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fix SQL injection vulnerabilities"})," (CRITICAL)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Implement payment callback signature verification"})," (CRITICAL)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Add foreign key constraints"})," (HIGH)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Enhance authorization checks"})," (HIGH)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Implement comprehensive logging"})," (MEDIUM)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"recommended-next-steps",children:"Recommended Next Steps"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security audit"})," by external firm"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Penetration testing"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Code review"})," and refactoring"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Performance optimization"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Comprehensive testing suite"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This documentation provides a complete overview of the KAP Gold Trading Platform. For specific implementation details, refer to the source code and Laravel documentation."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Document Version"}),": 1.0",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Last Updated"}),": 2025-01-09",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Prepared By"}),": Claude Code Analysis",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Review Required"}),": Senior Developer, Security Team, Business Analyst"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>a});var i=r(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);